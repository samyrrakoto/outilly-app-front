<div id="documents" class="content">
  <h2 class="subtitle">Vérifier mon profil</h2>

  <div class="content discreet-text">
    Ces informations vous permettent de bénéficier du statut <span class="accepted">Vérifié(e)</span> et de percevoir votre argent
    lorsque vous réussissez une vente.
  </div>

  <div *ngIf="bankInfo" class="notification is-success">
    Votre RIB a bien été pris en compte
  </div>

  <article *ngIf="isKycCreated()" class="message is-success">
    <div class="message-body">
      <fa-icon [icon]="['fas', 'check-circle']"></fa-icon>
      Votre pièce d'identité a été validée.
    </div>
  </article>

  <div *ngIf="isKycAsked()" class="message is-info">
    <div class="message-body">
      <fa-icon [icon]="['fas', 'clock']"></fa-icon>
      Les documents ont bien été envoyés et sont en cours de vérification.
    </div>
  </div>

  <div *ngIf="isKycRefused()" class="message is-danger">
    <div class="message-body">
      <fa-icon [icon]="['fas', 'times-circle']"></fa-icon>
      Votre pièce d'identité a été refusée. Veuillez en proposer une autre.
    </div>
  </div>

  <div *ngIf="userManager.user.mangoPayData.ibanId !== null" class="content">
    <h2 class="subtitle has-text-left">RIB actuellement utilisé :</h2>

    <div class="content has-text-left">
      <span class="tag is-light"><span class="bold">IBAN</span>&nbsp;: {{ iban }}</span><br>
      <span class="tag is-light"><span class="bold">BIC</span>&nbsp;: {{ bic }}</span>
    </div>
  </div>

  <div class="columns">
    <div *ngIf="getKycDisplay()" class="column">
      <button class="button kyc is-dark is-small no-overflow" (click)="modals.open('kyc')">
        <fa-icon [icon]="['fas', 'plus']" class="side-icon"></fa-icon>
        Ajouter une pièce d'identité
      </button>
    </div>

    <div class="column">
      <button *ngIf="userManager.user.mangoPayData.ibanId === null" class="button kyc is-dark is-small no-overflow" (click)="modals.open('bank-account')">
        <fa-icon [icon]="['fas', 'plus']" class="side-icon"></fa-icon>
        Ajouter un RIB
      </button>

      <button *ngIf="userManager.user.mangoPayData.ibanId !== null" class="button kyc is-dark is-small no-overflow" (click)="modals.open('contact-form')">
        <fa-icon [icon]="['fas', 'plus']" class="side-icon"></fa-icon>
        Remplacer ce RIB
      </button>
    </div>
  </div>
</div>


<!-- MODALS -->

<!-- Kyc Modal -->
<div class="modal {{ modals.get('kyc') }}">
  <div class="modal-background" (click)="modals.close('kyc')"></div>
  <div class="modal-content">
    <div class="box">

      <h2 class="subtitle">Ajouter une pièce d'identité</h2>

      <div class="content">
        De quel type de pièce d'identité s'agit-il ?
      </div>

      <div class="columns has-text-centered">
        <div class="column">
          <div id="id-card" class="content tile" (click)="setFocus('id-card'); kycType = 'id-card'">
            <fa-icon [icon]="['fas', 'id-card']" class="side-icon"></fa-icon>
            Carte d'identité
          </div>
        </div>

        <div class="column">
          <div id="passport" class="content tile" (click)="setFocus('passport'); kycType = 'passport'">
            <fa-icon [icon]="['fas', 'passport']" class="side-icon"></fa-icon>
            Passeport
          </div>
        </div>
      </div>

      <!-- Error display -->
      <div class="error" *ngFor="let message of errorManager.messages">
        {{ message }}
      </div>

      <input accept="{{ acceptedKycFormats }}" type="file" id="kyc" name="product-pictures" (change)="handleFile($event)" style="display: none;">


      <h2 *ngIf="kycSent.length > 0" class="subtitle">
        Documents envoyés :
      </h2>

      <div class="columns is-centered is-vcentered">
      <div class="column" *ngFor="let kyc of kycUrl; index as i">
        <div class="content">
          <img [src]="kyc" height="50px" width="auto" class="kyc-doc" [alt]="kycSent[i]" [title]="kycSent[i]">
        </div>

        <div class="content green">
          {{ kycSent[i] }}
        </div>
      </div>
      </div>

      <div *ngIf="!loading" class="content">
        <button *ngIf="kycType && !recto" class="button kyc is-dark is-small no-overflow addspaceabove" (click)="page='recto'; openImgPicker('kyc')">
          <fa-icon [icon]="['fas', 'plus']" class="side-icon"></fa-icon>
          Ajouter le recto
        </button>

        <button *ngIf="recto && kycType === 'id-card' && !verso" class="button kyc is-dark is-small no-overflow addspaceabove" (click)="page='verso'; openImgPicker('kyc')">
          <fa-icon [icon]="['fas', 'plus']" class="side-icon"></fa-icon>
          Ajouter le verso
        </button>

        <button *ngIf="isKycComplete() && !isKycAsked()" (click)="askKycValidation()" class="button is-success addspaceabove">Valider ma pièce d'identité</button>
      </div>

      <div *ngIf="loading">
        <button class="button is-light is-loading"></button>
      </div>
    </div>
  </div>
  <button class="modal-close is-large" (click)="modals.close('kyc')"></button>
</div>

<!-- Bank account Modal -->
<div id="bank-account" class="modal {{ modals.get('bank-account') }}">
  <div class="modal-background" (click)="modals.close('bank-account')"></div>
  <div class="modal-content">
    <div class="box">

    <h2 class="subtitle">Ajouter un RIB</h2>

    <div *ngIf="bankInfo === false" class="notification is-danger">
      Le RIB est incorrect
    </div>

    <div class="field is-horizontal is-mobile">
      <div class="field-label is-normal">
        <label class="label">IBAN</label>
      </div>
      <div class="field-body">
        <div class="field">
          <p class="control has-text-centered-mobile">
            <input class="input" [(ngModel)]="iban">
          </p>
        </div>
      </div>
    </div>

    <div class="field is-horizontal is-mobile">
      <div class="field-label is-normal">
        <label class="label">BIC</label>
      </div>
      <div class="field-body">
        <div class="field">
          <p class="control has-text-centered-mobile">
            <input class="input" [(ngModel)]="bic">
          </p>
        </div>
      </div>
    </div>

    <button class="button is-success" (click)="bankAccountRegister()">Ajouter ce RIB</button>

    </div>
  </div>
  <button class="modal-close is-large" (click)="modals.close('bank-account')"></button>
</div>

<!-- <app-contact-form
  [click]=click
  [chosenSubject]=chosenSubject
  [message]=message>
</app-contact-form> -->

<div class="modal {{ modals.get('contact-form') }}">
  <div class="modal-background" (click)="modals.close('contact-form')"></div>
  <div class="modal-content">
    <div class="box">
      <app-contact-form
        [chosenSubject]=chosenSubject
        [message]=message>
      </app-contact-form>
    </div>
  </div>
  <button class="modal-close is-large" aria-label="close" (click)="modals.close('contact-form')"></button>
</div>
